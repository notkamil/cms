# Лабораторная 7: Документация по интерфейсам и алгоритмам

## 1. Архитектура

| Слой | Технологии | Назначение |
|------|------------|------------|
| **Frontend** | React, Vite, React Router | SPA: экраны участника и персонала, вызовы API |
| **Backend** | REST API | Авторизация (JWT), бизнес-логика, доступ к БД |
| **БД** | (из лабы 3) | Хранение пользователей, пространств, бронирований, подписок, транзакций |

**Кто с кем общается:**
- Браузер → Frontend (статическая раздача + маршрутизация).
- Frontend → Backend по `VITE_API_URL`: все данные через REST, заголовок `Authorization: Bearer <token>`.
- Два типа токенов: **участник** (`/api/me/*`, `/api/auth/*`) и **персонал** (`/api/staff/*`).
- Backend → БД: запросы на чтение/запись; ответы возвращаются клиенту в JSON.

---

## 2. Ручки API (по группам)

### Auth
| Метод | Путь | Назначение |
|-------|------|------------|
| POST | `/api/auth/login` | Вход участника (email, password) |
| POST | `/api/auth/register` | Регистрация участника |
| POST | `/api/staff/auth/login` | Вход персонала |

### Участник — профиль и кабинет (`/api/me`)
| Метод | Путь | Назначение |
|-------|------|------------|
| GET | `/api/me` | Профиль (баланс, данные) |
| PATCH | `/api/me` | Обновить профиль |
| PUT | `/api/me/password` | Сменить пароль |
| GET | `/api/me/settings` | Настройки (слоты, рабочие часы и т.д.) |
| GET | `/api/me/transactions` | История транзакций |
| POST | `/api/me/balance/deposit` | Пополнение баланса |

### Участник — пространства и бронирования
| Метод | Путь | Назначение |
|-------|------|------------|
| GET | `/api/me/spaces/list` | Список пространств (краткий) |
| GET | `/api/me/spaces/:id` | Данные пространства по id |
| GET | `/api/me/bookings?date=` | Бронирования на дату |
| GET | `/api/me/bookings/list` | Список «мои брони» |
| POST | `/api/me/bookings` | Создать бронирование (разовое или по подписке) |
| POST | `/api/me/bookings/:id/cancel` | Отменить бронирование |
| PATCH | `/api/me/bookings/:id` | Изменить участников брони |
| GET | `/api/me/members/search?q=` | Поиск участников (добавить в бронь) |

### Участник — подписки и тарифы
| Метод | Путь | Назначение |
|-------|------|------------|
| GET | `/api/me/subscriptions?spaceId=&forBooking=` | Текущие подписки (обзор / для брони) |
| GET | `/api/me/tariffs/available` | Доступные тарифы |
| GET | `/api/me/tariffs/hourly?spaceId=` | Почасовые тарифы по пространству |
| GET | `/api/me/tariffs/:id/spaces` | Пространства для тарифа (напр. для «Фикс») |
| POST | `/api/me/subscriptions` | Оформить подписку |

### Персонал — себя и настройки (`/api/staff`)
| Метод | Путь | Назначение |
|-------|------|------------|
| GET | `/api/staff/me` | Профиль сотрудника |
| PUT | `/api/staff/me/password` | Сменить пароль |
| GET | `/api/staff/settings` | Настройки системы |
| PATCH | `/api/staff/settings` | Обновить настройки |

### Персонал — сотрудники, пространства, типы, удобства
| Метод | Путь | Назначение |
|-------|------|------------|
| GET | `/api/staff/staff` | Список сотрудников |
| POST | `/api/staff/staff` | Добавить сотрудника |
| PATCH | `/api/staff/staff/:id` | Изменить сотрудника (в т.ч. восстановить роль) |
| POST | `/api/staff/staff/:id/dismiss` | Уволить |
| GET | `/api/staff/spaces` | Список пространств |
| GET | `/api/staff/spaces/:id` | Пространство с деталями |
| POST | `/api/staff/spaces` | Создать пространство |
| PATCH | `/api/staff/spaces/:id` | Изменить / освободить (status: available) |
| DELETE | `/api/staff/spaces/:id` | Удалить пространство |
| GET | `/api/staff/space-types` | Типы пространств |
| GET | `/api/staff/space-types/:id/spaces` | Пространства данного типа |
| POST | `/api/staff/space-types` | Создать тип |
| PATCH | `/api/staff/space-types/:id` | Изменить тип |
| DELETE | `/api/staff/space-types/:id` | Удалить тип |
| GET | `/api/staff/amenities` | Удобства |
| GET | `/api/staff/amenities/:id/spaces` | Привязки удобства к пространствам |
| POST | `/api/staff/amenities` | Создать удобство |
| PATCH | `/api/staff/amenities/:id` | Изменить удобство |
| DELETE | `/api/staff/amenities/:id` | Удалить удобство |
| PUT | `/api/staff/space-amenities` | Задать привязки удобств к пространствам |

### Персонал — тарифы, подписки, бронирования
| Метод | Путь | Назначение |
|-------|------|------------|
| GET | `/api/staff/tariffs` | Тарифы |
| POST | `/api/staff/tariffs` | Создать тариф |
| PATCH | `/api/staff/tariffs/:id` | Изменить тариф |
| DELETE | `/api/staff/tariffs/:id` | Удалить тариф |
| PUT | `/api/staff/tariff-spaces` | Привязки тарифов к пространствам |
| GET | `/api/staff/subscriptions` | Подписки |
| POST | `/api/staff/subscriptions/:id/cancel` | Отменить подписку |
| GET | `/api/staff/bookings?date=` | Бронирования на дату |
| GET | `/api/staff/bookings/:id` | Детали брони |
| POST | `/api/staff/bookings/:id/cancel` | Отменить бронь |
| PATCH | `/api/staff/bookings/:id` | Изменить участников брони |
| GET | `/api/staff/members/search?q=` | Поиск участников |

---

## 3. Экраны и сценарии

### Экраны (маршрут → назначение)

| Маршрут | Эран | Назначение |
|---------|------|------------|
| `/` | Главная | Лендинг, вход / регистрация участника |
| `/cabinet` | Личный кабинет | Профиль, баланс, пополнение, транзакции, смена пароля |
| `/subscriptions` | Подписки | Текущие подписки, оформление новой |
| `/spaces` | Пространства | Список пространств для участника |
| `/bookings` | Бронирования | Календарь, выбор слота, создание брони (разовое / по подписке) |
| `/bookings/my` | Мои брони | Список бронирований, отмена, редактирование участников |
| `/cms` | Пасхалка | Скрытый маршрут (тройной клик по логотипу → главная) |
| `/staff` | Вход персонала | Форма входа для сотрудников |
| `/staff/cabinet` | Кабинет сотрудника | Профиль, смена пароля |
| `/staff/staff` | Сотрудники | Список, добавление, увольнение, роли |
| `/staff/spaces` | Пространства (админ) | Типы и пространства: CRUD |
| `/staff/amenities` | Удобства | Удобства и привязки к пространствам |
| `/staff/tariffs` | Тарифы | Тарифы и привязки к пространствам |
| `/staff/subscriptions` | Подписки (админ) | Просмотр, отмена подписок |
| `/staff/bookings` | Брони (админ) | Брони по дате, отмена, редактирование участников |
| `/staff/settings` | Настройки | Системные настройки (слоты, рабочие часы и т.д.) |
| `*` | 404 | Страница «не найдено» |

### Сценарии (кратко)

**Сценарий 1: Участник создаёт разовое бронирование**
1. Вход на `/bookings`, выбор пространства и даты.
2. Загрузка настроек (`/api/me/settings`), пространств, почасовых тарифов (`/api/me/tariffs/hourly?spaceId=`) и слотов.
3. Выбор времени и тарифа, при необходимости — добавление участников (`/api/me/members/search`).
4. Отправка `POST /api/me/bookings` (one_time, tariffId и др.).
5. Результат: бронь создана, переход к просмотру / «мои брони».

**Сценарий 2: Участник оформляет подписку и бронирует по ней**
1. `/subscriptions` → «Оформить»; выбор тарифа и даты начала, при тарифе «Фикс» — выбор пространства (`/api/me/tariffs/:id/spaces`).
2. `POST /api/me/subscriptions` → подписка создана.
3. `/bookings` → выбор «по подписке», загрузка текущих подписок (`/api/me/subscriptions?forBooking=1`).
4. Выбор подписки, слота, при необходимости — участников; `POST /api/me/bookings` (subscription, subscriptionId).
5. Бронирование создано за счёт минут подписки.
